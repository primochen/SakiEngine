{
    "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
    "name": "SakiScript",
    "scopeName": "source.sks",
    "patterns": [
        {
            "include": "#first-line-identifier"
        },
        {
            "include": "#animation-content"
        },
        {
            "include": "#label-content"
        },
        {
            "include": "#pose-content" 
        },
        {
            "include": "#config-content"
        },
        {
            "include": "#character-content"
        },
        {
            "include": "#comments"
        }
    ],
    "repository": {
        "first-line-identifier": {
            "patterns": [
                {
                    "name": "comment.line.first-identifier.sks",
                    "match": "^\\s*(//\\w+//)(.*)$",
                    "captures": {
                        "1": {
                            "name": "constant.other.identifier.sks"
                        },
                        "2": {
                            "name": "comment.line.description.sks"
                        }
                    }
                }
            ]
        },
        "animation-content": {
            "patterns": [
                {
                    "include": "#animation-definitions"
                },
                {
                    "include": "#animation-keyframes"
                },
                {
                    "include": "#comments"
                }
            ]
        },
        "label-content": {
            "patterns": [
                {
                    "include": "#keywords"
                },
                {
                    "include": "#strings"
                },
                {
                    "include": "#variables"
                },
                {
                    "include": "#labels"
                },
                {
                    "include": "#characters"
                },
                {
                    "include": "#menu-choices"
                },
                {
                    "include": "#animation-syntax"
                }
            ]
        },
        "pose-content": {
            "patterns": [
                {
                    "include": "#pose-definitions"
                },
                {
                    "include": "#pose-parameters"
                },
                {
                    "include": "#numeric-values"
                }
            ]
        },
        "config-content": {
            "patterns": [
                {
                    "include": "#config-keys"
                },
                {
                    "include": "#config-values"
                },
                {
                    "include": "#color-values"
                },
                {
                    "include": "#numeric-values"
                }
            ]
        },
        "character-content": {
            "patterns": [
                {
                    "include": "#character-definitions"
                },
                {
                    "include": "#strings"
                }
            ]
        },
        "comments": {
            "patterns": [
                {
                    "name": "comment.line.double-slash.sks",
                    "match": "//.*$"
                }
            ]
        },
        "keywords": {
            "patterns": [
                {
                    "name": "keyword.control.sks",
                    "match": "\\b(label|scene|show|at|menu|endmenu|jump|if|else|endif|return|nvl|endnvl|nvlm|endnvlm|timer|fx|with|an|play|stop|anime|cg)\\b"
                },
                {
                    "include": "#scene-syntax"
                },
                {
                    "include": "#anime-syntax"
                },
                {
                    "include": "#cg-syntax"
                },
                {
                    "include": "#fx-syntax"
                },
                {
                    "include": "#animation-syntax"
                }
            ]
        },
        "strings": {
            "patterns": [
                {
                    "name": "string.quoted.double.sks",
                    "begin": "\"",
                    "end": "\"",
                    "patterns": [
                        {
                            "name": "constant.character.escape.sks",
                            "match": "\\\\."
                        }
                    ]
                }
            ]
        },
        "variables": {
            "patterns": [
                {
                    "name": "variable.other.sks",
                    "match": "\\$\\w+"
                }
            ]
        },
        "labels": {
            "patterns": [
                {
                    "name": "entity.name.function.label.sks",
                    "match": "^\\s*label\\s+([\\w_]+)",
                    "captures": {
                        "1": {
                            "name": "entity.name.function.label.sks"
                        }
                    }
                }
            ]
        },
        "characters": {
            "patterns": [
                {
                    "name": "meta.character.timed-expression.sks",
                    "match": "^\\s*([\\w_]+)\\s*(\\[[^,]+,[^,]+,[^\\]]+\\])\\s+(\".*?\")\\s*$",
                    "captures": {
                        "1": {
                            "name": "entity.name.type.character.sks"
                        },
                        "2": {
                            "name": "meta.character.timed-expression-bracket.sks",
                            "patterns": [
                                {
                                    "name": "punctuation.definition.bracket.begin.sks",
                                    "match": "\\["
                                },
                                {
                                    "name": "entity.name.type.expression.start.sks",
                                    "match": "([^,]+)(?=,)"
                                },
                                {
                                    "name": "constant.numeric.delay.sks",
                                    "match": "(?<=,)([^,]+)(?=,)"
                                },
                                {
                                    "name": "entity.name.type.expression.end.sks",
                                    "match": "(?<=,)([^\\]]+)(?=\\])"
                                },
                                {
                                    "name": "punctuation.definition.bracket.end.sks",
                                    "match": "\\]"
                                }
                            ]
                        },
                        "3": {
                            "name": "string.quoted.double.sks"
                        }
                    }
                },
                {
                    "name": "entity.name.type.character.sks",
                    "match": "^\\s*([\\w_]+)(?=\\s*(?:[\\w_]+\\s+)*\")",
                    "captures": {
                        "1": {
                            "name": "entity.name.type.character.sks"
                        }
                    }
                }
            ]
        },
        "menu-choices": {
            "patterns": [
                {
                    "name": "string.quoted.double.menu-choice.sks",
                    "match": "^\\s*(\".*?\")\\s*([\\w_]+)?",
                    "captures": {
                        "1": {
                            "name": "string.quoted.double.menu-choice.sks"
                        },
                        "2": {
                            "name": "entity.name.function.label.sks"
                        }
                    }
                }
            ]
        },
        "pose-definitions": {
            "patterns": [
                {
                    "name": "entity.name.function.pose.sks",
                    "match": "^\\s*([\\w_]+)\\s*:",
                    "captures": {
                        "1": {
                            "name": "entity.name.function.pose.sks"
                        }
                    }
                }
            ]
        },
        "pose-parameters": {
            "patterns": [
                {
                    "name": "variable.parameter.sks",
                    "match": "\\b(scale|xcenter|ycenter|anchor)(?=\\s*=)",
                    "captures": {
                        "1": {
                            "name": "variable.parameter.sks"
                        }
                    }
                },
                {
                    "name": "constant.other.anchor.sks",
                    "match": "\\b(center|bottomCenter|topCenter|centerLeft|centerRight)\\b"
                }
            ]
        },
        "config-keys": {
            "patterns": [
                {
                    "name": "entity.name.function.config-key.sks",
                    "match": "^\\s*([a-zA-Z_][a-zA-Z0-9_]*)\\s*:",
                    "captures": {
                        "1": {
                            "name": "entity.name.function.config-key.sks"
                        }
                    }
                },
                {
                    "name": "variable.parameter.sks",
                    "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)(?=\\s*=)",
                    "captures": {
                        "1": {
                            "name": "variable.parameter.sks"
                        }
                    }
                }
            ]
        },
        "config-values": {
            "patterns": [
                {
                    "name": "string.unquoted.config-value.sks",
                    "match": "(?<=\\s)([a-zA-Z_][a-zA-Z0-9_\\-]*)\\b"
                }
            ]
        },
        "character-definitions": {
            "patterns": [
                {
                    "name": "entity.name.type.character-alias.sks",
                    "match": "^\\s*([\\w_]+)\\s*:",
                    "captures": {
                        "1": {
                            "name": "entity.name.type.character-alias.sks"
                        }
                    }
                },
                {
                    "name": "keyword.other.at.sks", 
                    "match": "\\b(at)\\b"
                }
            ]
        },
        "color-values": {
            "patterns": [
                {
                    "name": "constant.other.color.rgb.sks",
                    "match": "\\brgb\\s*\\(\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*\\d+\\s*\\)"
                },
                {
                    "name": "constant.other.color.hex.sks",
                    "match": "#[0-9a-fA-F]{3,8}"
                }
            ]
        },
        "numeric-values": {
            "patterns": [
                {
                    "name": "constant.numeric.sks",
                    "match": "\\b\\d+(?:\\.\\d+)?\\b"
                }
            ]
        },
        "fx-syntax": {
            "patterns": [
                {
                    "name": "entity.name.function.fx.sks",
                    "match": "\\b(fx)\\s+(dreamy|nostalgic|blur)\\b",
                    "captures": {
                        "1": {
                            "name": "keyword.control.sks"
                        },
                        "2": {
                            "name": "entity.name.type.filter.sks"
                        }
                    }
                },
                {
                    "name": "variable.parameter.fx.sks",
                    "match": "\\b(intensity|animation|duration):",
                    "captures": {
                        "1": {
                            "name": "variable.parameter.fx.sks"
                        }
                    }
                },
                {
                    "name": "constant.other.animation.sks",
                    "match": "\\b(pulse|fade|wave|none)\\b"
                }
            ]
        },
        "anime-syntax": {
            "patterns": [
                {
                    "name": "meta.anime-command.sks",
                    "match": "^\\s*(anime)\\s+([\\w\\-_]+)(?:\\s+(keep|loop))*\\s*$",
                    "captures": {
                        "1": {
                            "name": "keyword.control.sks"
                        },
                        "2": {
                            "name": "entity.name.type.animation-file.sks"
                        },
                        "3": {
                            "name": "constant.other.anime-parameter.sks"
                        }
                    }
                }
            ]
        },
        "cg-syntax": {
            "patterns": [
                {
                    "name": "meta.cg-command.sks",
                    "match": "^\\s*(cg)\\s+([\\w\\-_#.]+)\\s*$",
                    "captures": {
                        "1": {
                            "name": "keyword.control.sks"
                        },
                        "2": {
                            "name": "entity.name.type.cg-file.sks"
                        }
                    }
                }
            ]
        },
        "scene-syntax": {
            "patterns": [
                {
                    "name": "keyword.other.scene-command.sks",
                    "match": "^\\s*(scene)\\s+([\\w\\-_#.]+)(?:\\s+(with)\\s+(fade|diss|dissolve|wipe|slide))?(?:\\s+(timer)\\s+(\\d+(?:\\.\\d+)?))?(?:\\s+(fx)\\s+(.+?))?\\s*$",
                    "captures": {
                        "1": {
                            "name": "keyword.control.sks"
                        },
                        "2": {
                            "name": "entity.name.type.background.sks"
                        },
                        "3": {
                            "name": "keyword.other.with.sks"
                        },
                        "4": {
                            "name": "constant.other.transition-type.sks"
                        },
                        "5": {
                            "name": "keyword.control.sks"
                        },
                        "6": {
                            "name": "constant.numeric.timer.sks"
                        },
                        "7": {
                            "name": "keyword.control.sks"
                        },
                        "8": {
                            "name": "entity.name.type.filter.sks"
                        }
                    }
                },
                {
                    "name": "constant.other.transition-type.sks",
                    "match": "\\b(fade|diss|dissolve|wipe|slide)\\b"
                }
            ]
        },
        "animation-definitions": {
            "patterns": [
                {
                    "name": "entity.name.function.animation-definition.sks",
                    "match": "^\\s*(\\w+)\\s*$",
                    "captures": {
                        "1": {
                            "name": "entity.name.function.animation-definition.sks"
                        }
                    }
                }
            ]
        },
        "animation-keyframes": {
            "patterns": [
                {
                    "name": "meta.animation.keyframe.sks",
                    "match": "^\\s*(ease|linear)\\s+(\\d+(?:\\.\\d+)?)\\s+(.+)$",
                    "captures": {
                        "1": {
                            "name": "keyword.control.animation-type.sks"
                        },
                        "2": {
                            "name": "constant.numeric.duration.sks"
                        },
                        "3": {
                            "name": "meta.animation.properties.sks",
                            "patterns": [
                                {
                                    "name": "variable.parameter.animation-property.sks",
                                    "match": "\\b(xcenter|ycenter|scale|alpha)([+-])(\\d+(?:\\.\\d+)?)\\b",
                                    "captures": {
                                        "1": {
                                            "name": "variable.parameter.animation-property.sks"
                                        },
                                        "2": {
                                            "name": "keyword.operator.sks"
                                        },
                                        "3": {
                                            "name": "constant.numeric.sks"
                                        }
                                    }
                                }
                            ]
                        }
                    }
                }
            ]
        },
        "animation-syntax": {
            "patterns": [
                {
                    "name": "meta.character.animation.sks",
                    "match": "\\b(an)\\s+(\\w+)\\b",
                    "captures": {
                        "1": {
                            "name": "keyword.control.animation.sks"
                        },
                        "2": {
                            "name": "entity.name.function.animation.sks"
                        }
                    }
                }
            ]
        }
    }
}